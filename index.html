<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phishing Tracking</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <div class="message-box">
            <h1>Voc√™ caiu em um ataque de phishing!</h1>
            <p>Por favor, inicie o curso de conscientiza√ß√£o para aprender como evitar este tipo de ataque no futuro.</p>
            
            
           <button onclick="registrarClique()">Come√ßar o Curso</button>
        </div>
    </div>

    <button id="exportButton" style="display: none;" onclick="exportCSV()">Baixar Registros</button>

    <script>
        // Captura a key da URL
        const urlParams = new URLSearchParams(window.location.search);
        const userKey = urlParams.get('key');

        if (userKey) {
            console.log("Usu√°rio identific√°vel pela chave:", userKey);

            // Recupera as chaves salvas no localStorage
            let storedKeys = JSON.parse(localStorage.getItem('phishingKeys')) || [];

            // Adiciona a nova key com um timestamp
            storedKeys.push({
                timestamp: new Date().toISOString(),
                key: userKey
            });

            // Salva no localStorage
            localStorage.setItem('phishingKeys', JSON.stringify(storedKeys));
        }

        // Fun√ß√£o para exportar os dados como CSV
        function exportCSV() {
            let storedKeys = JSON.parse(localStorage.getItem('phishingKeys')) || [];
            if (storedKeys.length === 0) {
                alert("Nenhum dado para exportar!");
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,Timestamp,Key\n";
            storedKeys.forEach(entry => {
                csvContent += `${entry.timestamp},${entry.key}\n`;
            });

            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "phishing_tracking.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // üîπ Op√ß√£o 1: Mostrar bot√£o apenas digitando no console
        window.revealButton = function() {
            document.getElementById('exportButton').style.display = 'block';
        };
        console.log("Digite revealButton() no console para ver o bot√£o de exporta√ß√£o.");

        // üîπ Op√ß√£o 2: Atalho no teclado (Shift + X)
        document.addEventListener("keydown", function(event) {
            if (event.shiftKey && event.key === "X") {
                document.getElementById('exportButton').style.display = 'block';
            }
        });

        // üîπ Op√ß√£o 3: Mostrar bot√£o se a key for "admin"
        if (userKey === "admin") {
            document.getElementById('exportButton').style.display = 'block';
        }


function registrarClique() {
    fetch("https://script.google.com/macros/s/AKfycbzTMc4XrRCNhbSGraWidSLgVgHtWWBrY2o4olwvv9cAdPH8F1MdjDHXPFxh_JLRhr25/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ clique: "Usu√°rio clicou" })
    })
    .then(response => response.text())
    .then(data => {
        alert("Registrado com sucesso!");
        // ‚úÖ Somente agora redireciona para o curso
        window.location.href = 'slide1.html';
    })
    .catch(error => console.error("Erro:", error));
}

    
    
 }
    </script>

</body>
</html>
