<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phishing Tracking</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="container">
        <div class="message-box">
            <h1>Voc√™ caiu em um ataque de phishing!</h1>
            <p>Por favor, inicie o curso de conscientiza√ß√£o para aprender como evitar este tipo de ataque no futuro.</p>
            <button onclick="window.location.href='slide1.html'">Come√ßar o Curso</button>
        </div>
    </div>

    <button id="exportButton" style="display: none;" onclick="exportCSV()">Baixar Registros</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // üîπ Configura√ß√£o do Firebase
        const firebaseConfig = {
            databaseURL: "https://campanha-de-phishing-default-rtdb.firebaseio.com/"
        };

        // üîπ Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // üîπ Captura a key da URL
        const urlParams = new URLSearchParams(window.location.search);
        const userKey = urlParams.get('key');

        if (userKey) {
            const deviceInfo = {
                timestamp: new Date().toISOString(),
                key: userKey,
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height
            };

            // üîπ Salva os dados no Firebase
            push(ref(database, "phishingLogs"), deviceInfo);
        }

        // üîπ Fun√ß√£o para exportar os dados como CSV
        window.exportCSV = function() {
            get(ref(database, "phishingLogs")).then(snapshot => {
                let csvContent = "data:text/csv;charset=utf-8,Timestamp,Key,UserAgent,Platform,ScreenWidth,ScreenHeight\n";
                snapshot.forEach(entry => {
                    const data = entry.val();
                    csvContent += `${data.timestamp},${data.key},${data.userAgent},${data.platform},${data.screenWidth},${data.screenHeight}\n`;
                });

                let encodedUri = encodeURI(csvContent);
                let link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "phishing_tracking.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
        };

        // üîπ Se a key for "admin", mostrar o bot√£o de exporta√ß√£o
        if (userKey === "admin") {
            document.getElementById('exportButton').style.display = 'block';
        }
    </script>

</body>
</html>
