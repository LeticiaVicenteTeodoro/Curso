<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phishing Tracking</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="container">
        <div class="message-box">
            <h1>Voc√™ caiu em um ataque de phishing!</h1>
            <p>Por favor, inicie o curso de conscientiza√ß√£o para aprender como evitar este tipo de ataque no futuro.</p>
            <button onclick="window.location.href='slide1.html'">Come√ßar o Curso</button>
        </div>
    </div>

    <button id="exportButton" style="display: none;" onclick="exportExcel()">Baixar Registros</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        import * as XLSX from "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js";

        // üîπ Configura√ß√£o do Firebase
        const firebaseConfig = {
            databaseURL: "https://campanha-de-phishing-default-rtdb.firebaseio.com/"
        };

        // üîπ Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // üîπ Captura a key da URL
        const urlParams = new URLSearchParams(window.location.search);
        const userKey = urlParams.get('key');

        if (userKey) {
            const data = {
                timestamp: new Date().toISOString(),
                key: userKey
            };

            // üîπ Salva os dados no Firebase
            push(ref(database, "phishingLogs"), data);
        }

        // üîπ Fun√ß√£o para exportar os dados como Excel
        window.exportExcel = function() {
            get(ref(database, "phishingLogs")).then(snapshot => {
                let logs = [];

                snapshot.forEach(entry => {
                    const data = entry.val();
                    logs.push({ Key: data.key });
                });

                if (logs.length === 0) {
                    alert("Nenhum dado para exportar!");
                    return;
                }

                let ws = XLSX.utils.json_to_sheet(logs);
                let wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Phishing Logs");
                XLSX.writeFile(wb, "phishing_tracking.xlsx");
            });
        };

        // üîπ Se a key for "admin", mostrar o bot√£o de exporta√ß√£o
        if (userKey === "admin") {
            document.getElementById('exportButton').style.display = 'block';
        }
    </script>

</body>
</html>
